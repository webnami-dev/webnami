<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }}</title>
  <link rel="stylesheet" href="/admin/css/main.css">
  <!-- Prevent theme flash: apply saved theme before first paint -->
  <script>
    (function() {
      var saved = localStorage.adminTheme;
      var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      var dark = saved === 'dark' || (!saved && prefersDark);
      document.documentElement.setAttribute('admin-data-theme', dark ? 'dark' : 'light');
    })();
  </script>
  <script type="module" src="/admin/js/admin.js"></script>
</head>
<body class="bg-background text-content min-h-screen" style="font-family: var(--font-inter);">

  <div class="flex min-h-screen">

    <!-- Sidebar -->
    <aside class="fixed top-0 left-0 h-screen w-[220px] flex flex-col z-40" style="background-color: var(--color-sidebar); border-right: 1px solid var(--color-border-subtle);">

      <!-- Logo / Brand -->
      <div class="flex items-center gap-2.5 px-4 h-[52px] shrink-0" style="border-bottom: 1px solid var(--color-border-subtle);">
        <a href="/admin" class="flex items-center gap-2.5 min-w-0">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="26" viewBox="0 0 159 195" preserveAspectRatio="xMidYMid meet" class="shrink-0">
            <g transform="translate(0,195) scale(0.05,-0.05)" fill="var(--color-primary)" stroke="none">
              <path d="M1350 3138 c-1008 -249 -1250 -1616 -390 -2198 1059 -716 2367 496 1746 1617 -244 441 -859 705 -1356 581z m676 -135 c463 -166 785 -652 742 -1120 -49 -544 -995 -531 -995 13 1 266 201 442 446 392 109 -23 111 -17 28 116 -225 361 -808 231 -1224 -272 -174 -210 -261 -291 -373 -344 l-100 -47 -13 44 c-23 79 -17 261 12 401 137 642 856 1040 1477 817z"/>
            </g>
          </svg>
          <span class="text-sm font-semibold tracking-tight truncate" style="color: var(--color-content);">WebNami</span>
        </a>
      </div>

      <!-- Navigation -->
      <nav class="flex-1 px-2 py-3 flex flex-col gap-0.5 overflow-y-auto">
        <a href="/admin/posts"
          class="sidebar-nav-item flex items-center gap-2.5 px-3 py-2 rounded text-[13px] font-medium transition-colors duration-100"
          style="color: var(--color-accent);"
          onmouseover="if(!this.classList.contains('active')) this.style.backgroundColor='var(--color-sidebar-hover)'; this.style.color='var(--color-content)';"
          onmouseout="if(!this.classList.contains('active')) this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
          >
          <i data-lucide="file-text" style="width:15px;height:15px;flex-shrink:0;"></i>
          Posts
        </a>
        <a href="/admin/pages"
          class="sidebar-nav-item flex items-center gap-2.5 px-3 py-2 rounded text-[13px] font-medium transition-colors duration-100"
          style="color: var(--color-accent);"
          onmouseover="if(!this.classList.contains('active')) this.style.backgroundColor='var(--color-sidebar-hover)'; this.style.color='var(--color-content)';"
          onmouseout="if(!this.classList.contains('active')) this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
          >
          <i data-lucide="file" style="width:15px;height:15px;flex-shrink:0;"></i>
          Pages
        </a>
        <a href="/admin/settings"
          class="sidebar-nav-item flex items-center gap-2.5 px-3 py-2 rounded text-[13px] font-medium transition-colors duration-100"
          style="color: var(--color-accent);"
          onmouseover="if(!this.classList.contains('active')) this.style.backgroundColor='var(--color-sidebar-hover)'; this.style.color='var(--color-content)';"
          onmouseout="if(!this.classList.contains('active')) this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
          >
          <i data-lucide="sliders-horizontal" style="width:15px;height:15px;flex-shrink:0;"></i>
          Settings
        </a>
      </nav>

      <!-- Bottom actions -->
      <div class="px-2 py-3 flex flex-col gap-0.5" style="border-top: 1px solid var(--color-border-subtle);">
        <a href="/" target="_blank"
          class="flex items-center gap-2.5 px-3 py-2 rounded text-[13px] font-medium transition-colors duration-100"
          style="color: var(--color-accent);"
          onmouseover="this.style.backgroundColor='var(--color-sidebar-hover)'; this.style.color='var(--color-content)';"
          onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
          >
          <i data-lucide="external-link" style="width:15px;height:15px;flex-shrink:0;"></i>
          View Site
        </a>

        <!-- Theme toggle -->
        <div x-data>
          <button
            @click="$store.adminTheme.lightTheme()"
            class="w-full flex items-center gap-2.5 px-3 py-2 rounded text-[13px] font-medium transition-colors duration-100"
            style="color: var(--color-accent);"
            onmouseover="this.style.backgroundColor='var(--color-sidebar-hover)'; this.style.color='var(--color-content)';"
            onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
            x-show="$store.adminTheme.dark"
            aria-label="Switch to light mode"
          >
            <i data-lucide="sun" style="width:15px;height:15px;flex-shrink:0;"></i>
            Light Mode
          </button>
          <button
            @click="$store.adminTheme.darkTheme()"
            class="w-full flex items-center gap-2.5 px-3 py-2 rounded text-[13px] font-medium transition-colors duration-100"
            style="color: var(--color-accent);"
            onmouseover="this.style.backgroundColor='var(--color-sidebar-hover)'; this.style.color='var(--color-content)';"
            onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
            x-show="!$store.adminTheme.dark"
            aria-label="Switch to dark mode"
          >
            <i data-lucide="moon" style="width:15px;height:15px;flex-shrink:0;"></i>
            Dark Mode
          </button>
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <div class="flex-1 ml-[220px] flex flex-col min-h-screen">

      {% include "components/alerts.njk" %}
      {% include "components/seo-modal.njk" %}

      <main class="flex-1 px-10 py-8 max-w-9/10">
        {% block content %}{% endblock %}
      </main>

    </div>
  </div>

  <!-- Active nav highlight -->
  <script>
    (function() {
      var path = window.location.pathname;
      var items = document.querySelectorAll('.sidebar-nav-item');
      items.forEach(function(item) {
        var href = item.getAttribute('href');
        if (!href) return;
        // Match exact or sub-path (e.g. /admin/posts matches /admin/posts/new)
        if (path === href || path.startsWith(href + '/')) {
          item.classList.add('active');
          item.style.backgroundColor = 'var(--color-sidebar-active)';
          item.style.color = 'var(--color-primary)';
          item.onmouseover = null;
          item.onmouseout = null;
        }
      });
    })();
  </script>

</body>
</html>
