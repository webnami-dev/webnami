{% extends "base.njk" %}

{% macro imageSelect(id, name, label, currentValue, images) %}
  <div>
    <label for="{{ id }}" class="admin-label">{{ label }}</label>
    <select id="{{ id }}" name="{{ name }}" class="admin-input">
      {% for img in images %}
        <option value="{{ img }}" {% if img == currentValue %}selected{% endif %}>{{ img }}</option>
      {% endfor %}
    </select>
  </div>
{% endmacro %}

{% block content %}
  <div>
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-[22px] font-semibold tracking-tight" style="color: var(--color-content); line-height: 1.2;">Settings</h1>
    </div>

    <form id="settings-form" class="flex flex-col gap-0">

      {# ── General ── #}
      <section class="settings-section">
        <div class="flex flex-col gap-2">
          <div class="flex items-center gap-2">
            <span class="w-28 shrink-0 text-[13px]" style="color: var(--color-content);">Blog Name</span>
            <input type="text" id="blogName" name="blogName" value="{{ config.site.name }}" class="admin-input">
          </div>
          <div class="flex items-center gap-2">
            <span class="w-28 shrink-0 text-[13px]" style="color: var(--color-content);">Posts Per Page</span>
            <input type="number" id="postsPerPage" name="postsPerPage" value="{{ config.postsPerPage }}" min="1" class="admin-input">
          </div>
          <div class="flex items-center gap-2">
            <span class="w-28 shrink-0 text-[13px]" style="color: var(--color-content);">Theme</span>
            <select id="theme" name="theme" class="admin-input">
              {% for t in themes %}
                <option value="{{ t }}" {% if t == config.theme %}selected{% endif %}>{{ t }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-28 shrink-0 text-[13px]" style="color: var(--color-content);">Homepage Heading</span>
            <input type="text" id="homepageHeading" name="homepageHeading" value="{{ config.homepage.heading }}" class="admin-input">
          </div>
        </div>
      </section>

      {# ── Site Assets (collapsed) ── #}
      <section class="settings-section">
        <div x-data="{ open: false }">
          <button type="button" @click="open = !open"
            class="flex items-center gap-2 text-[12px] font-medium transition-colors duration-100 cursor-pointer"
            style="color: var(--color-accent);"
            onmouseover="this.style.color='var(--color-content)';"
            onmouseout="this.style.color='var(--color-accent)';"
            >
            <i data-lucide="chevron-right" style="width:13px;height:13px;transition:transform 0.15s;" :style="open ? 'transform:rotate(90deg);' : ''"></i>
            <label class="admin-label cursor-pointer">Site Settings</label>
          </button>
          <div x-show="open" x-collapse class="mt-3">
            <div class="flex flex-col gap-3">
              <div class="flex items-start gap-2">
                <span class="w-28 shrink-0 text-[13px] pt-1.5" style="color: var(--color-content);">Logo</span>
                <div class="flex-1">
                  <select id="siteLogo" name="siteLogo" class="admin-input">
                    {% for img in images %}
                      <option value="{{ img }}" {% if img == config.site.logo %}selected{% endif %}>{{ img }}</option>
                    {% endfor %}
                  </select>
                  <p class="text-[11px] mt-1" style="color: var(--color-accent);">Shown in the site header and navbar.</p>
                </div>
              </div>
              <div class="flex items-start gap-2">
                <span class="w-28 shrink-0 text-[13px] pt-1.5" style="color: var(--color-content);">Favicon</span>
                <div class="flex-1">
                  <select id="siteFavicon" name="siteFavicon" class="admin-input">
                    {% for img in images %}
                      <option value="{{ img }}" {% if img == config.site.favicon %}selected{% endif %}>{{ img }}</option>
                    {% endfor %}
                  </select>
                  <p class="text-[11px] mt-1" style="color: var(--color-accent);">Small icon shown in browser tabs and bookmarks.</p>
                </div>
              </div>
              <div class="flex items-start gap-2">
                <span class="w-28 shrink-0 text-[13px] pt-1.5" style="color: var(--color-content);">OG Image</span>
                <div class="flex-1">
                  <select id="homepageImg" name="homepageImg" class="admin-input">
                    {% for img in images %}
                      <option value="{{ img }}" {% if img == config.homepage.metadata.img %}selected{% endif %}>{{ img }}</option>
                    {% endfor %}
                  </select>
                  <p class="text-[11px] mt-1" style="color: var(--color-accent);">Displayed when your homepage is shared on social media.</p>
                </div>
              </div>
              <div class="flex items-start gap-2">
                <span class="w-28 shrink-0 text-[13px] pt-1.5" style="color: var(--color-content);">Blog URL</span>
                <div class="flex-1">
                  <input type="url" id="blogUrl" name="blogUrl" value="{{ config.site.url }}" class="admin-input">
                  <p class="text-[11px] mt-1" style="color: var(--color-accent);">Public URL of your site. Used for SEO metadata and RSS feed links.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {# ── Footer ── #}
      <section class="settings-section">
        <div x-data="{ open: false }">
          <button type="button" @click="open = !open"
            class="flex items-center gap-2 text-[12px] font-medium transition-colors duration-100 cursor-pointer"
            style="color: var(--color-accent);"
            onmouseover="this.style.color='var(--color-content)';"
            onmouseout="this.style.color='var(--color-accent)';"
            >
            <i data-lucide="chevron-right" style="width:13px;height:13px;transition:transform 0.15s;" :style="open ? 'transform:rotate(90deg);' : ''"></i>
            <label class="admin-label cursor-pointer">Social Links</label>
          </button>
          <div x-show="open" x-collapse class="mt-3">
            <div class="flex flex-col gap-2" id="social-links">
              {% for link in config.footer.socialLinks %}
                <div class="flex items-center gap-2 social-link-row">
                  <span class="w-28 shrink-0 text-[13px] capitalize" style="color: var(--color-content);">{{ link.name }}</span>
                  <input type="text" placeholder="{{ link.placeholder }}" value="{{ link.href }}"
                    class="admin-input social-link-href">
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </section>

      <!-- Save -->
      <div class="pt-2 pb-8">
        <button type="submit"
          class="inline-flex items-center gap-1.5 px-4 py-2 rounded text-[13px] font-medium text-white transition-opacity duration-100"
          style="background-color: var(--color-primary);"
          onmouseover="this.style.opacity='0.88';"
          onmouseout="this.style.opacity='1';"
          >
          <i data-lucide="save" style="width:14px;height:14px;"></i>
          Save Settings
        </button>
      </div>

    </form>
  </div>

  <script type="module" src="/admin/js/settings.js"></script>
{% endblock %}
