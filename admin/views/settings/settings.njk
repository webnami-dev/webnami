{% extends "base.njk" %}

{% macro imageSelect(id, name, label, currentValue, images) %}
  <div>
    <label for="{{ id }}" class="admin-label">{{ label }}</label>
    <select id="{{ id }}" name="{{ name }}" class="admin-input">
      {% for img in images %}
        <option value="{{ img }}" {% if img == currentValue %}selected{% endif %}>{{ img }}</option>
      {% endfor %}
    </select>
  </div>
{% endmacro %}

{% block content %}
  <div>
    <!-- Header -->
    <div class="mb-8">
      <p class="text-[11px] font-medium mb-0.5" style="color: var(--color-accent); letter-spacing: 0.06em; text-transform: uppercase;">Configuration</p>
      <h1 class="text-[22px] font-semibold tracking-tight" style="color: var(--color-content); line-height: 1.2;">Settings</h1>
    </div>

    <form id="settings-form" class="flex flex-col gap-0">

      {# ── General ── #}
      <section class="settings-section">
        <h2 class="text-[13px] font-semibold mb-5 flex items-center gap-2" style="color: var(--color-content);">
          <i data-lucide="settings" style="width:14px;height:14px;color:var(--color-accent);"></i>
          General
        </h2>
        <div class="flex flex-col gap-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="siteName" class="admin-label">Site Name</label>
              <input type="text" id="siteName" name="siteName" value="{{ config.site.name }}" class="admin-input">
            </div>
            <div>
              <label for="siteUrl" class="admin-label">Site URL</label>
              <input type="url" id="siteUrl" name="siteUrl" value="{{ config.site.url }}" class="admin-input">
            </div>
          </div>
          <div class="grid grid-cols-3 gap-4">
            <div>
              <label for="postsPerPage" class="admin-label">Posts Per Page</label>
              <input type="number" id="postsPerPage" name="postsPerPage" value="{{ config.postsPerPage }}" min="1" class="admin-input">
            </div>
            <div>
              <label for="theme" class="admin-label">Theme</label>
              <select id="theme" name="theme" class="admin-input">
                {% for t in themes %}
                  <option value="{{ t }}" {% if t == config.theme %}selected{% endif %}>{{ t }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            {{ imageSelect("siteLogo", "siteLogo", "Logo", config.site.logo, images) }}
            {{ imageSelect("siteFavicon", "siteFavicon", "Favicon", config.site.favicon, images) }}
          </div>
          <div>
            <label for="homepageHeading" class="admin-label">Homepage Heading</label>
            <input type="text" id="homepageHeading" name="homepageHeading" value="{{ config.homepage.heading }}" class="admin-input">
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="homepageTitle" class="admin-label">Homepage Meta Title</label>
              <input type="text" id="homepageTitle" name="homepageTitle" value="{{ config.homepage.metadata.title }}" class="admin-input">
            </div>
            {{ imageSelect("homepageImg", "homepageImg", "Homepage OG Image", config.homepage.metadata.img, images) }}
          </div>
          <div>
            <label for="homepageDescription" class="admin-label">Homepage Meta Description</label>
            <input type="text" id="homepageDescription" name="homepageDescription" value="{{ config.homepage.metadata.description }}" class="admin-input">
          </div>
        </div>
      </section>

      {# ── Navbar ── #}
      <section class="settings-section">
        <h2 class="text-[13px] font-semibold mb-5 flex items-center gap-2" style="color: var(--color-content);">
          <i data-lucide="menu" style="width:14px;height:14px;color:var(--color-accent);"></i>
          Navbar
        </h2>
        <div class="flex flex-col gap-2" id="navbar-links">
          {% for link in config.navbar.links %}
            <div class="flex items-center gap-2 navbar-link-row">
              <input type="text" placeholder="Label" value="{{ link.name }}"
                class="admin-input navbar-link-name">
              <input type="text" placeholder="/path" value="{{ link.href }}"
                class="admin-input navbar-link-href">
              <button type="button"
                class="shrink-0 p-1.5 rounded transition-colors duration-100 remove-row"
                style="color: var(--color-accent); border: 1px solid var(--color-border);"
                onmouseover="this.style.color='#e03131'; this.style.borderColor='color-mix(in srgb, #e03131 35%, transparent)';"
                onmouseout="this.style.color='var(--color-accent)'; this.style.borderColor='var(--color-border)';"
                aria-label="Remove">
                <i data-lucide="x" style="width:14px;height:14px;"></i>
              </button>
            </div>
          {% endfor %}
        </div>
        <button type="button" id="add-navbar-link"
          class="mt-3 inline-flex items-center gap-1.5 px-3 py-1.5 rounded text-[12.5px] font-medium transition-colors duration-100"
          style="color: var(--color-accent); border: 1px solid var(--color-border);"
          onmouseover="this.style.backgroundColor='var(--color-hover)'; this.style.color='var(--color-content)';"
          onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
          >
          <i data-lucide="plus" style="width:13px;height:13px;"></i>
          Add Link
        </button>
      </section>

      {# ── Footer ── #}
      <section class="settings-section">
        <h2 class="text-[13px] font-semibold mb-5 flex items-center gap-2" style="color: var(--color-content);">
          <i data-lucide="layout-template" style="width:14px;height:14px;color:var(--color-accent);"></i>
          Footer
        </h2>

        <p class="text-[11px] font-semibold mb-3" style="color: var(--color-accent); letter-spacing: 0.06em; text-transform: uppercase;">Social Links</p>
        <div class="flex flex-col gap-2" id="social-links">
          {% for link in config.footer.socialLinks %}
            <div class="flex items-center gap-2 social-link-row">
              <input type="text" placeholder="Platform (e.g. facebook)" value="{{ link.name }}"
                class="admin-input social-link-name">
              <input type="text" placeholder="URL" value="{{ link.href }}"
                class="admin-input social-link-href">
              <button type="button"
                class="shrink-0 p-1.5 rounded transition-colors duration-100 remove-row"
                style="color: var(--color-accent); border: 1px solid var(--color-border);"
                onmouseover="this.style.color='#e03131'; this.style.borderColor='color-mix(in srgb, #e03131 35%, transparent)';"
                onmouseout="this.style.color='var(--color-accent)'; this.style.borderColor='var(--color-border)';"
                aria-label="Remove">
                <i data-lucide="x" style="width:14px;height:14px;"></i>
              </button>
            </div>
          {% endfor %}
        </div>
        <button type="button" id="add-social-link"
          class="mt-3 mb-7 inline-flex items-center gap-1.5 px-3 py-1.5 rounded text-[12.5px] font-medium transition-colors duration-100"
          style="color: var(--color-accent); border: 1px solid var(--color-border);"
          onmouseover="this.style.backgroundColor='var(--color-hover)'; this.style.color='var(--color-content)';"
          onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
          >
          <i data-lucide="plus" style="width:13px;height:13px;"></i>
          Add Social Link
        </button>

        <p class="text-[11px] font-semibold mb-3" style="color: var(--color-accent); letter-spacing: 0.06em; text-transform: uppercase;">Link Groups</p>
        <div class="flex flex-col gap-4" id="link-groups">
          {% for group in config.footer.linkGroups %}
            <div class="link-group">
              <div class="flex items-center gap-2 mb-3">
                <input type="text" placeholder="Group Title (optional)" value="{{ group.title }}"
                  class="admin-input group-title">
                <button type="button"
                  class="shrink-0 p-1.5 rounded transition-colors duration-100 remove-group"
                  style="color: var(--color-accent); border: 1px solid var(--color-border);"
                  onmouseover="this.style.color='#e03131'; this.style.borderColor='color-mix(in srgb, #e03131 35%, transparent)';"
                  onmouseout="this.style.color='var(--color-accent)'; this.style.borderColor='var(--color-border)';"
                  aria-label="Remove group">
                  <i data-lucide="trash-2" style="width:14px;height:14px;"></i>
                </button>
              </div>
              <div class="flex flex-col gap-2 group-links">
                {% for link in group.links %}
                  <div class="flex items-center gap-2 group-link-row">
                    <input type="text" placeholder="Label" value="{{ link.name }}"
                      class="admin-input group-link-name">
                    <input type="text" placeholder="/path" value="{{ link.href }}"
                      class="admin-input group-link-href">
                    <button type="button"
                      class="shrink-0 p-1.5 rounded transition-colors duration-100 remove-row"
                      style="color: var(--color-accent); border: 1px solid var(--color-border);"
                      onmouseover="this.style.color='#e03131'; this.style.borderColor='color-mix(in srgb, #e03131 35%, transparent)';"
                      onmouseout="this.style.color='var(--color-accent)'; this.style.borderColor='var(--color-border)';"
                      aria-label="Remove">
                      <i data-lucide="x" style="width:14px;height:14px;"></i>
                    </button>
                  </div>
                {% endfor %}
              </div>
              <button type="button"
                class="mt-3 inline-flex items-center gap-1.5 px-3 py-1.5 rounded text-[12.5px] font-medium transition-colors duration-100 add-group-link"
                style="color: var(--color-accent); border: 1px solid var(--color-border);"
                onmouseover="this.style.backgroundColor='var(--color-hover)'; this.style.color='var(--color-content)';"
                onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
                >
                <i data-lucide="plus" style="width:13px;height:13px;"></i>
                Add Link
              </button>
            </div>
          {% endfor %}
        </div>
        <button type="button" id="add-link-group"
          class="mt-4 inline-flex items-center gap-1.5 px-3 py-1.5 rounded text-[12.5px] font-medium transition-colors duration-100"
          style="color: var(--color-accent); border: 1px solid var(--color-border);"
          onmouseover="this.style.backgroundColor='var(--color-hover)'; this.style.color='var(--color-content)';"
          onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-accent)';"
          >
          <i data-lucide="plus" style="width:13px;height:13px;"></i>
          Add Link Group
        </button>
      </section>

      <!-- Save -->
      <div class="pt-2 pb-8">
        <button type="submit"
          class="inline-flex items-center gap-1.5 px-4 py-2 rounded text-[13px] font-medium text-white transition-opacity duration-100"
          style="background-color: var(--color-primary);"
          onmouseover="this.style.opacity='0.88';"
          onmouseout="this.style.opacity='1';"
          >
          <i data-lucide="save" style="width:14px;height:14px;"></i>
          Save Settings
        </button>
      </div>

    </form>
  </div>

  <script type="module" src="/admin/js/settings.js"></script>
{% endblock %}
